<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ODCV Timeline - Continuous Scroll</title>
    <style>
        :root {
            --occupied-color: #4CAF50;
            --unoccupied-color: #f44336;
            --active-color: #2196F3;
            --standby-color: #FF9800;
            --violation-color: #9C27B0;
            --missing-data: #e0e0e0;
            --grid-line: #ddd;
            --row-height-base: 60px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 15px 20px;
            border-bottom: 2px solid #e0e0e0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
        }

        h1 {
            font-size: 18px;
            color: #333;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .density-control {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        .density-slider {
            width: 100px;
        }

        .btn {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #f0f0f0;
        }

        .btn-primary {
            background: var(--active-color);
            color: white;
            border-color: var(--active-color);
        }

        /* Minimap Navigator */
        .minimap {
            position: fixed;
            right: 20px;
            top: 80px;
            width: 200px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            z-index: 90;
        }

        .minimap-header {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .minimap-canvas {
            position: relative;
            height: 300px;
            background: #fafafa;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
        }

        .minimap-days {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
        }

        .minimap-day {
            flex: 1;
            border-bottom: 1px solid #f0f0f0;
            position: relative;
            cursor: pointer;
            transition: background 0.2s;
        }

        .minimap-day:hover {
            background: rgba(33, 150, 243, 0.1);
        }

        .minimap-day-label {
            position: absolute;
            left: 2px;
            top: 2px;
            font-size: 9px;
            color: #666;
        }

        .minimap-activity {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            background: linear-gradient(to left,
                var(--occupied-color) 0%,
                var(--occupied-color) 50%,
                var(--active-color) 50%,
                var(--active-color) 100%);
        }

        .minimap-violations {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--violation-color);
        }

        .viewport-indicator {
            position: absolute;
            left: 0;
            right: 0;
            background: rgba(33, 150, 243, 0.3);
            border: 2px solid var(--active-color);
            pointer-events: none;
            transition: top 0.1s, height 0.1s;
        }

        /* Main Timeline Container */
        .timeline-container {
            margin-top: 60px;
            padding: 20px;
            padding-right: 240px; /* Space for minimap */
        }

        .day-separator {
            background: white;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .day-header {
            background: #f8f8f8;
            padding: 12px 20px;
            border-bottom: 2px solid #e0e0e0;
            position: sticky;
            top: 60px;
            z-index: 50;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .day-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .day-stats {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #666;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .zones-container {
            padding: 20px;
        }

        .zone-row {
            margin-bottom: 25px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s;
        }

        .zone-row.expanded {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .zone-header {
            background: #fafafa;
            padding: 10px 15px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .zone-header:hover {
            background: #f0f0f0;
        }

        .zone-name {
            font-weight: 600;
            font-size: 14px;
            color: #333;
        }

        .zone-summary {
            font-size: 11px;
            color: #666;
        }

        .signal-response-grid {
            padding: 15px;
            background: white;
            min-height: var(--row-height-base);
            transition: min-height 0.3s;
        }

        .signal-response-grid.compressed {
            min-height: 40px;
        }

        .signal-response-grid.expanded {
            min-height: 120px;
        }

        .timeline-row {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            position: relative;
            height: 40px;
            transition: height 0.3s;
        }

        .compressed .timeline-row {
            height: 25px;
            margin-bottom: 4px;
        }

        .expanded .timeline-row {
            height: 50px;
            margin-bottom: 10px;
        }

        .row-label {
            width: 80px;
            font-size: 11px;
            color: #666;
            font-weight: 600;
            padding-right: 10px;
            text-align: right;
        }

        .data-stream {
            flex: 1;
            height: 100%;
            display: flex;
            gap: 0;
            background: #fafafa;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }

        .hour-block {
            flex: 1;
            display: flex;
            border-right: 1px solid rgba(255,255,255,0.5);
            position: relative;
        }

        .data-segment {
            flex: 1;
            min-width: 1px;
            cursor: pointer;
            transition: transform 0.1s;
        }

        .data-segment:hover {
            transform: scaleY(1.2);
            z-index: 10;
        }

        .data-segment.occupied { background: var(--occupied-color); }
        .data-segment.unoccupied { background: var(--unoccupied-color); }
        .data-segment.active { background: var(--active-color); }
        .data-segment.standby { background: var(--standby-color); }
        .data-segment.missing {
            background: var(--missing-data);
            background-image: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 2px,
                rgba(0,0,0,0.1) 2px,
                rgba(0,0,0,0.1) 4px
            );
        }

        .violation-marker {
            position: absolute;
            top: -5px;
            bottom: -5px;
            width: 3px;
            background: var(--violation-color);
            z-index: 15;
        }

        .hour-markers {
            display: flex;
            padding-left: 80px;
            margin-top: 5px;
        }

        .hour-mark {
            flex: 1;
            text-align: center;
            font-size: 10px;
            color: #999;
            border-left: 1px solid #f0f0f0;
            padding: 2px;
        }

        /* Loading indicators */
        .loading-spinner {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--active-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Scroll position indicator */
        .scroll-indicator {
            position: fixed;
            left: 20px;
            bottom: 20px;
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            font-size: 12px;
            z-index: 80;
        }

        .legend {
            position: fixed;
            left: 20px;
            bottom: 60px;
            background: white;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            font-size: 11px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-box {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }

        .tooltip {
            position: fixed;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 11px;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }

        /* Virtual scrolling placeholder */
        .virtual-spacer {
            height: 0;
            transition: height 0.3s;
        }

        /* Activity-based row height */
        .high-activity {
            --row-height-base: 80px;
        }

        .low-activity {
            --row-height-base: 40px;
        }

        .auto-scroll-controls {
            position: fixed;
            right: 20px;
            bottom: 20px;
            background: white;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            display: flex;
            gap: 10px;
            z-index: 80;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ODCV Timeline - September 2025 - Continuous Scroll</h1>
        <div class="header-controls">
            <div class="density-control">
                <label>Data Density:</label>
                <input type="range" class="density-slider" id="density-slider"
                       min="1" max="5" value="3" onchange="updateDensity()">
                <span id="density-value">Medium</span>
            </div>
            <button class="btn" onclick="jumpToViolation()">Next Violation</button>
            <button class="btn btn-primary" onclick="jumpToNow()">Jump to Now</button>
        </div>
    </div>

    <!-- Minimap Navigator -->
    <div class="minimap">
        <div class="minimap-header">Month Overview</div>
        <div class="minimap-canvas">
            <div class="minimap-days" id="minimap-days"></div>
            <div class="viewport-indicator" id="viewport-indicator"></div>
        </div>
    </div>

    <!-- Main Timeline -->
    <div class="timeline-container" id="timeline-container">
        <!-- Days will be dynamically loaded here -->
    </div>

    <!-- Scroll Indicator -->
    <div class="scroll-indicator" id="scroll-indicator">
        <strong>Position:</strong> <span id="current-position">Sept 1, 00:00</span>
    </div>

    <!-- Auto-scroll Controls -->
    <div class="auto-scroll-controls">
        <button class="btn" onclick="toggleAutoScroll()">
            <span id="auto-scroll-text">▶ Auto-Scroll</span>
        </button>
        <button class="btn" onclick="scrollSpeed(-1)">Slower</button>
        <button class="btn" onclick="scrollSpeed(1)">Faster</button>
    </div>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-box" style="background: var(--occupied-color)"></div>
            <span>Occupied</span>
        </div>
        <div class="legend-item">
            <div class="legend-box" style="background: var(--unoccupied-color)"></div>
            <span>Unoccupied</span>
        </div>
        <div class="legend-item">
            <div class="legend-box" style="background: var(--active-color)"></div>
            <span>Active</span>
        </div>
        <div class="legend-item">
            <div class="legend-box" style="background: var(--standby-color)"></div>
            <span>Standby</span>
        </div>
        <div class="legend-item">
            <div class="legend-box" style="background: var(--violation-color)"></div>
            <span>Violation</span>
        </div>
        <div class="legend-item">
            <div class="legend-box" style="background: var(--missing-data)"></div>
            <span>Missing</span>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        let monthData = {};
        let loadedDays = new Set();
        let currentDensity = 3;
        let autoScrolling = false;
        let scrollSpeedMultiplier = 1;
        let violationPositions = [];
        let currentViolationIndex = 0;

        // Generate month data
        function generateMonthData() {
            const zones = ['BV200', 'BV201', 'BV202'];

            zones.forEach(zone => {
                monthData[zone] = [];

                for (let day = 1; day <= 30; day++) {
                    const dayData = {
                        occupancy: [],
                        control: [],
                        violations: [],
                        activityLevel: 'normal'
                    };

                    let totalActivity = 0;

                    for (let hour = 0; hour < 24; hour++) {
                        const hourOccupancy = [];
                        const dayOfWeek = (day - 1) % 7;

                        for (let i = 0; i < 120; i++) {
                            let occupied = false;

                            if (dayOfWeek < 5) { // Weekday
                                if (hour >= 8 && hour <= 18) {
                                    occupied = Math.random() > 0.3;
                                } else {
                                    occupied = Math.random() > 0.95;
                                }
                            } else { // Weekend
                                occupied = Math.random() > 0.9;
                            }

                            if (Math.random() < 0.02) {
                                hourOccupancy.push(null);
                            } else {
                                hourOccupancy.push(occupied);
                                if (occupied) totalActivity++;
                            }
                        }
                        dayData.occupancy.push(hourOccupancy);

                        const hourControl = [];
                        for (let i = 0; i < 60; i++) {
                            const lookback = hourOccupancy.slice(Math.max(0, i * 2 - 30), i * 2);
                            const hasOccupancy = lookback.some(o => o === true);
                            let control = hasOccupancy ? 'active' : 'standby';

                            if (Math.random() < 0.03) {
                                control = hasOccupancy ? 'standby' : 'active';
                                dayData.violations.push({ hour, minute: i });
                                violationPositions.push({ day, hour, minute: i, zone });
                            }

                            if (Math.random() < 0.01) {
                                hourControl.push(null);
                            } else {
                                hourControl.push(control);
                            }
                        }
                        dayData.control.push(hourControl);
                    }

                    // Determine activity level for variable row height
                    const avgActivity = totalActivity / (24 * 120);
                    if (avgActivity > 0.4) {
                        dayData.activityLevel = 'high';
                    } else if (avgActivity < 0.1) {
                        dayData.activityLevel = 'low';
                    }

                    monthData[zone].push(dayData);
                }
            });

            // Sort violations by position
            violationPositions.sort((a, b) => {
                const posA = a.day * 1440 + a.hour * 60 + a.minute;
                const posB = b.day * 1440 + b.hour * 60 + b.minute;
                return posA - posB;
            });
        }

        // Initialize minimap
        function initMinimap() {
            const container = document.getElementById('minimap-days');

            for (let day = 1; day <= 30; day++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'minimap-day';
                dayDiv.onclick = () => jumpToDay(day);

                // Calculate day statistics
                let avgOccupancy = 0;
                let violations = 0;

                Object.keys(monthData).forEach(zone => {
                    const dayOccupancy = monthData[zone][day - 1].occupancy.flat();
                    const occupied = dayOccupancy.filter(o => o === true).length;
                    avgOccupancy += occupied / dayOccupancy.length;
                    violations += monthData[zone][day - 1].violations.length;
                });

                avgOccupancy = avgOccupancy / 3;

                dayDiv.innerHTML = `
                    <div class="minimap-day-label">${day}</div>
                    ${violations > 0 ? '<div class="minimap-violations"></div>' : ''}
                    <div class="minimap-activity" style="width: ${avgOccupancy * 70 + 30}%"></div>
                `;

                container.appendChild(dayDiv);
            }

            updateViewportIndicator();
        }

        // Render a day's timeline
        function renderDay(day) {
            if (loadedDays.has(day)) return;
            loadedDays.add(day);

            const container = document.getElementById('timeline-container');
            const daySeparator = document.createElement('div');
            daySeparator.className = 'day-separator';
            daySeparator.dataset.day = day;

            // Calculate day statistics
            let totalViolations = 0;
            let avgOccupancy = 0;
            let dataCompleteness = 0;

            Object.keys(monthData).forEach(zone => {
                totalViolations += monthData[zone][day - 1].violations.length;
                const dayData = monthData[zone][day - 1].occupancy.flat();
                const occupied = dayData.filter(o => o === true).length;
                const complete = dayData.filter(o => o !== null).length;
                avgOccupancy += occupied / dayData.length;
                dataCompleteness += complete / dayData.length;
            });

            avgOccupancy = Math.round((avgOccupancy / 3) * 100);
            dataCompleteness = Math.round((dataCompleteness / 3) * 100);

            daySeparator.innerHTML = `
                <div class="day-header">
                    <div class="day-title">September ${day}, 2025</div>
                    <div class="day-stats">
                        <div class="stat-item">
                            <span>Occupancy:</span>
                            <strong>${avgOccupancy}%</strong>
                        </div>
                        <div class="stat-item">
                            <span>Data Quality:</span>
                            <strong>${dataCompleteness}%</strong>
                        </div>
                        <div class="stat-item">
                            <span>Violations:</span>
                            <strong style="color: ${totalViolations > 0 ? 'var(--violation-color)' : 'green'}">
                                ${totalViolations}
                            </strong>
                        </div>
                    </div>
                </div>
                <div class="zones-container">
                    ${renderZones(day)}
                </div>
            `;

            // Insert in correct position
            const days = Array.from(container.querySelectorAll('.day-separator'));
            const insertBefore = days.find(d => parseInt(d.dataset.day) > day);

            if (insertBefore) {
                container.insertBefore(daySeparator, insertBefore);
            } else {
                container.appendChild(daySeparator);
            }
        }

        function renderZones(day) {
            let html = '';

            Object.keys(monthData).forEach(zone => {
                const dayData = monthData[zone][day - 1];
                const violations = dayData.violations.length;
                const activityClass = dayData.activityLevel;

                html += `
                    <div class="zone-row ${activityClass}">
                        <div class="zone-header" onclick="toggleZone(this)">
                            <div class="zone-name">${zone}</div>
                            <div class="zone-summary">${violations} violations today</div>
                        </div>
                        <div class="signal-response-grid" data-density="${currentDensity}">
                            <div class="timeline-row">
                                <div class="row-label">Occupancy</div>
                                <div class="data-stream">
                                    ${renderDataStream(dayData.occupancy, 'occupancy', currentDensity)}
                                </div>
                            </div>
                            <div class="timeline-row">
                                <div class="row-label">Control</div>
                                <div class="data-stream">
                                    ${renderDataStream(dayData.control, 'control', currentDensity)}
                                    ${renderViolationMarkers(dayData.violations)}
                                </div>
                            </div>
                            <div class="hour-markers">
                                ${Array.from({length: 24}, (_, i) =>
                                    `<div class="hour-mark">${i.toString().padStart(2, '0')}</div>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                `;
            });

            return html;
        }

        function renderDataStream(data, type, density) {
            let html = '';
            const segmentsPerHour = Math.max(1, 6 - density); // 1-5 segments based on density

            for (let hour = 0; hour < 24; hour++) {
                html += '<div class="hour-block">';

                const hourData = data[hour];
                const segmentSize = Math.ceil(hourData.length / segmentsPerHour);

                for (let seg = 0; seg < segmentsPerHour; seg++) {
                    const startIdx = seg * segmentSize;
                    const endIdx = Math.min((seg + 1) * segmentSize, hourData.length);
                    const segment = hourData.slice(startIdx, endIdx);

                    let className = 'missing';
                    if (segment.some(d => d !== null)) {
                        if (type === 'occupancy') {
                            const occupied = segment.filter(d => d === true).length;
                            className = occupied > segment.length / 2 ? 'occupied' : 'unoccupied';
                        } else {
                            const active = segment.filter(d => d === 'active').length;
                            className = active > segment.length / 2 ? 'active' : 'standby';
                        }
                    }

                    html += `<div class="data-segment ${className}"
                                  data-hour="${hour}"
                                  data-segment="${seg}"></div>`;
                }

                html += '</div>';
            }

            return html;
        }

        function renderViolationMarkers(violations) {
            let html = '';
            violations.forEach(v => {
                const position = ((v.hour * 60 + v.minute) / 1440) * 100;
                html += `<div class="violation-marker" style="left: ${position}%"></div>`;
            });
            return html;
        }

        // Infinite scroll implementation
        function initInfiniteScroll() {
            let isLoading = false;

            window.addEventListener('scroll', () => {
                if (isLoading) return;

                const scrollTop = window.pageYOffset;
                const windowHeight = window.innerHeight;
                const documentHeight = document.body.scrollHeight;

                // Update scroll position indicator
                updateScrollPosition();

                // Load more content when near bottom
                if (scrollTop + windowHeight > documentHeight - 1000) {
                    isLoading = true;
                    loadMoreDays('down');
                    setTimeout(() => { isLoading = false; }, 500);
                }

                // Load previous content when near top
                if (scrollTop < 1000) {
                    isLoading = true;
                    loadMoreDays('up');
                    setTimeout(() => { isLoading = false; }, 500);
                }

                updateViewportIndicator();
            });

            // Initial load
            loadInitialDays();
        }

        function loadInitialDays() {
            for (let day = 1; day <= 3; day++) {
                renderDay(day);
            }
        }

        function loadMoreDays(direction) {
            const maxLoaded = Math.max(...loadedDays);
            const minLoaded = Math.min(...loadedDays);

            if (direction === 'down' && maxLoaded < 30) {
                for (let i = 1; i <= 2 && maxLoaded + i <= 30; i++) {
                    renderDay(maxLoaded + i);
                }
            } else if (direction === 'up' && minLoaded > 1) {
                for (let i = 1; i <= 2 && minLoaded - i >= 1; i++) {
                    renderDay(minLoaded - i);
                }
            }
        }

        // Navigation functions
        function jumpToDay(day) {
            if (!loadedDays.has(day)) {
                renderDay(day);
            }

            setTimeout(() => {
                const dayElement = document.querySelector(`.day-separator[data-day="${day}"]`);
                if (dayElement) {
                    dayElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
        }

        function jumpToNow() {
            // Simulate "now" as Sept 15, 14:00
            jumpToDay(15);
        }

        function jumpToViolation() {
            if (violationPositions.length === 0) return;

            const violation = violationPositions[currentViolationIndex];
            currentViolationIndex = (currentViolationIndex + 1) % violationPositions.length;

            jumpToDay(violation.day);
        }

        // Density control
        function updateDensity() {
            const slider = document.getElementById('density-slider');
            currentDensity = parseInt(slider.value);

            const densityLabels = ['Minimal', 'Low', 'Medium', 'High', 'Maximum'];
            document.getElementById('density-value').textContent = densityLabels[currentDensity - 1];

            // Update all existing grids
            document.querySelectorAll('.signal-response-grid').forEach(grid => {
                const classes = ['compressed', '', '', '', 'expanded'];
                grid.className = 'signal-response-grid ' + (classes[currentDensity - 1] || '');
            });
        }

        // Auto-scroll functionality
        function toggleAutoScroll() {
            autoScrolling = !autoScrolling;
            const btn = document.getElementById('auto-scroll-text');

            if (autoScrolling) {
                btn.textContent = '⏸ Pause';
                startAutoScroll();
            } else {
                btn.textContent = '▶ Auto-Scroll';
            }
        }

        function startAutoScroll() {
            if (!autoScrolling) return;

            window.scrollBy({
                top: 2 * scrollSpeedMultiplier,
                behavior: 'smooth'
            });

            requestAnimationFrame(startAutoScroll);
        }

        function scrollSpeed(change) {
            scrollSpeedMultiplier = Math.max(0.5, Math.min(5, scrollSpeedMultiplier + change * 0.5));
        }

        // UI Updates
        function updateScrollPosition() {
            const scrollTop = window.pageYOffset;
            const dayElements = document.querySelectorAll('.day-separator');

            for (let el of dayElements) {
                const rect = el.getBoundingClientRect();
                if (rect.top > 0) {
                    const day = parseInt(el.dataset.day);
                    const progress = Math.max(0, -rect.top / el.offsetHeight);
                    const hour = Math.floor(progress * 24);

                    document.getElementById('current-position').textContent =
                        `Sept ${day}, ${hour.toString().padStart(2, '0')}:00`;
                    break;
                }
            }
        }

        function updateViewportIndicator() {
            const indicator = document.getElementById('viewport-indicator');
            const scrollTop = window.pageYOffset;
            const windowHeight = window.innerHeight;
            const documentHeight = document.body.scrollHeight;

            const topPercent = (scrollTop / documentHeight) * 100;
            const heightPercent = (windowHeight / documentHeight) * 100;

            indicator.style.top = topPercent + '%';
            indicator.style.height = heightPercent + '%';
        }

        function toggleZone(header) {
            const zoneRow = header.parentElement;
            zoneRow.classList.toggle('expanded');
        }

        // Tooltip
        document.addEventListener('mousemove', (e) => {
            const tooltip = document.getElementById('tooltip');
            if (e.target.classList.contains('data-segment')) {
                const hour = e.target.dataset.hour;
                const segment = e.target.dataset.segment;

                let status = 'Unknown';
                if (e.target.classList.contains('occupied')) status = 'Occupied';
                if (e.target.classList.contains('unoccupied')) status = 'Unoccupied';
                if (e.target.classList.contains('active')) status = 'Active Mode';
                if (e.target.classList.contains('standby')) status = 'Standby Mode';
                if (e.target.classList.contains('missing')) status = 'Missing Data';

                tooltip.innerHTML = `${hour}:00 - Segment ${segment} - ${status}`;
                tooltip.style.display = 'block';
                tooltip.style.left = e.pageX + 10 + 'px';
                tooltip.style.top = e.pageY - 30 + 'px';
            } else {
                tooltip.style.display = 'none';
            }
        });

        // Initialize
        generateMonthData();
        initMinimap();
        initInfiniteScroll();
    </script>
</body>
</html>