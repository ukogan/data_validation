<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ODCV Mockup 3: Multi-Scale Ruler Timeline</title>
    <style>
        :root {
            --occupied: #10B981;
            --unoccupied: #9CA3AF;
            --active: #3B82F6;
            --standby: #D1D5DB;
            --violation: #EF4444;
            --ruler: #4B5563;
            --grid: #E5E7EB;
            --selected: #8B5CF6;
            --hover: #F3F4F6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0F172A;
            color: #1F2937;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: white;
        }

        .header {
            padding: 20px 24px;
            background: linear-gradient(90deg, #1E293B 0%, #334155 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
        }

        .header-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .zoom-indicator {
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            font-size: 13px;
        }

        .control-bar {
            padding: 12px 24px;
            background: #F8FAFC;
            border-bottom: 1px solid var(--grid);
            display: flex;
            gap: 24px;
            align-items: center;
        }

        .control-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .control-group label {
            font-size: 13px;
            color: #6B7280;
            font-weight: 500;
        }

        button {
            padding: 6px 12px;
            background: white;
            border: 1px solid #D1D5DB;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        button:hover {
            background: var(--hover);
            border-color: #9CA3AF;
        }

        button.active {
            background: var(--selected);
            color: white;
            border-color: var(--selected);
        }

        .scale-selector {
            display: flex;
            background: white;
            border: 1px solid #D1D5DB;
            border-radius: 6px;
            overflow: hidden;
        }

        .scale-selector button {
            border: none;
            border-radius: 0;
            border-right: 1px solid #D1D5DB;
        }

        .scale-selector button:last-child {
            border-right: none;
        }

        .timeline-viewport {
            flex: 1;
            overflow: hidden;
            position: relative;
            background: #FAFBFC;
        }

        .timeline-container {
            position: relative;
            height: 100%;
            overflow-x: auto;
            overflow-y: hidden;
        }

        .timeline-canvas {
            position: relative;
            width: 100%;
            height: 100%;
            min-width: 100%;
        }

        .ruler-container {
            position: sticky;
            top: 0;
            z-index: 10;
            background: white;
            border-bottom: 2px solid var(--grid);
            height: 80px;
        }

        .ruler {
            position: relative;
            height: 100%;
        }

        .ruler-scale {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .ruler-major {
            position: absolute;
            height: 30px;
            display: flex;
            align-items: flex-end;
            padding-bottom: 4px;
            font-size: 12px;
            font-weight: 500;
            color: var(--ruler);
            border-left: 2px solid var(--ruler);
        }

        .ruler-minor {
            position: absolute;
            height: 15px;
            border-left: 1px solid #CBD5E1;
        }

        .ruler-micro {
            position: absolute;
            height: 8px;
            border-left: 1px solid #E5E7EB;
        }

        .sensor-tracks {
            position: relative;
            padding: 20px 0;
        }

        .sensor-track {
            position: relative;
            margin-bottom: 16px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .track-header {
            padding: 12px 16px;
            background: #F9FAFB;
            border-bottom: 1px solid var(--grid);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .track-name {
            font-weight: 500;
            font-size: 14px;
        }

        .track-stats {
            display: flex;
            gap: 16px;
            font-size: 12px;
            color: #6B7280;
        }

        .track-content {
            position: relative;
            height: 100px;
        }

        .timeline-row {
            position: absolute;
            width: 100%;
            height: 40px;
        }

        .timeline-row.occupancy {
            top: 10px;
        }

        .timeline-row.control {
            top: 50px;
        }

        .timeline-segment {
            position: absolute;
            height: 30px;
            border-radius: 2px;
            transition: opacity 0.2s;
            cursor: pointer;
        }

        .timeline-segment:hover {
            opacity: 0.8;
        }

        .segment-occupied { background: var(--occupied); }
        .segment-unoccupied { background: var(--unoccupied); }
        .segment-active { background: var(--active); }
        .segment-standby { background: var(--standby); }

        .violation-marker {
            position: absolute;
            width: 2px;
            height: 60px;
            background: var(--violation);
            top: 20px;
            cursor: pointer;
            z-index: 5;
        }

        .violation-marker:hover {
            width: 4px;
            margin-left: -1px;
        }

        .time-cursor {
            position: absolute;
            width: 2px;
            height: 100%;
            background: var(--selected);
            pointer-events: none;
            z-index: 20;
            display: none;
        }

        .time-cursor.active {
            display: block;
        }

        .time-label {
            position: absolute;
            top: -20px;
            left: -30px;
            background: var(--selected);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            white-space: nowrap;
        }

        .navigation-bar {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border-radius: 12px;
            padding: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 8px;
            z-index: 30;
        }

        .nav-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 1px solid var(--grid);
            background: white;
            transition: all 0.2s;
        }

        .nav-btn:hover {
            background: var(--hover);
        }

        .nav-btn.active {
            background: var(--selected);
            color: white;
        }

        .minimap {
            position: absolute;
            bottom: 80px;
            right: 20px;
            width: 300px;
            height: 80px;
            background: white;
            border: 1px solid var(--grid);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 8px;
            z-index: 25;
        }

        .minimap-viewport {
            position: absolute;
            background: rgba(139, 92, 246, 0.2);
            border: 2px solid var(--selected);
            border-radius: 4px;
            cursor: move;
        }

        .minimap-content {
            width: 100%;
            height: 100%;
            position: relative;
            background: #F9FAFB;
            border-radius: 4px;
        }

        .minimap-track {
            height: 20px;
            margin: 2px 0;
            background: #E5E7EB;
            border-radius: 2px;
            position: relative;
            overflow: hidden;
        }

        .detail-tooltip {
            position: absolute;
            background: #1F2937;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 12px;
            pointer-events: none;
            z-index: 100;
            display: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .detail-tooltip.active {
            display: block;
        }

        .zoom-controls {
            position: absolute;
            top: 100px;
            right: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 4px;
            z-index: 30;
        }

        .zoom-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
            background: white;
            border-radius: 6px;
            font-size: 18px;
            transition: all 0.2s;
        }

        .zoom-btn:hover {
            background: var(--hover);
        }

        .zoom-slider {
            width: 120px;
            margin: 8px;
            transform: rotate(-90deg);
            transform-origin: center;
        }

        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: white;
            border-radius: 8px;
            padding: 12px 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            z-index: 30;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 4px 0;
            font-size: 12px;
        }

        .legend-color {
            width: 16px;
            height: 12px;
            border-radius: 2px;
        }

        .breadcrumb {
            padding: 8px 24px;
            background: #F9FAFB;
            border-bottom: 1px solid var(--grid);
            font-size: 13px;
            color: #6B7280;
        }

        .breadcrumb span {
            color: var(--selected);
            font-weight: 500;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--grid);
            border-top-color: var(--selected);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ODCV Multi-Scale Timeline - September 2025</h1>
            <div class="header-controls">
                <div class="zoom-indicator">Current View: <span id="zoomLevel">Day</span></div>
                <div class="zoom-indicator">Range: <span id="timeRange">Sept 15, 8AM - 8PM</span></div>
            </div>
        </div>

        <div class="control-bar">
            <div class="control-group">
                <label>Scale:</label>
                <div class="scale-selector">
                    <button onclick="setScale('month')">Month</button>
                    <button onclick="setScale('week')">Week</button>
                    <button onclick="setScale('day')" class="active">Day</button>
                    <button onclick="setScale('hour')">Hour</button>
                    <button onclick="setScale('minute')">5 Min</button>
                </div>
            </div>
            <div class="control-group">
                <label>Jump to:</label>
                <button onclick="jumpTo('today')">Today</button>
                <button onclick="jumpTo('lastViolation')">Last Violation</button>
                <button onclick="jumpTo('worstDay')">Worst Day</button>
            </div>
            <div class="control-group">
                <label>Display:</label>
                <button onclick="toggleLayer('violations')">Violations</button>
                <button onclick="toggleLayer('business')">Business Hours</button>
                <button onclick="toggleLayer('transitions')">Transitions</button>
            </div>
        </div>

        <div class="breadcrumb">
            September 2025 > Week 3 > <span>September 15 (Monday)</span>
        </div>

        <div class="timeline-viewport">
            <div class="timeline-container" id="timelineContainer">
                <div class="timeline-canvas" id="timelineCanvas">
                    <div class="ruler-container">
                        <div class="ruler" id="ruler">
                            <!-- Ruler markings will be generated dynamically -->
                        </div>
                    </div>

                    <div class="sensor-tracks" id="sensorTracks">
                        <!-- Sensor tracks will be generated dynamically -->
                    </div>

                    <div class="time-cursor" id="timeCursor">
                        <div class="time-label" id="timeLabel">Sept 15, 10:30 AM</div>
                    </div>
                </div>
            </div>

            <!-- Zoom Controls -->
            <div class="zoom-controls">
                <button class="zoom-btn" onclick="zoomIn()">+</button>
                <input type="range" class="zoom-slider" min="1" max="5" value="3" onchange="updateZoom(this.value)">
                <button class="zoom-btn" onclick="zoomOut()">−</button>
            </div>

            <!-- Minimap -->
            <div class="minimap" id="minimap">
                <div class="minimap-content">
                    <div class="minimap-track"></div>
                    <div class="minimap-track"></div>
                    <div class="minimap-track"></div>
                </div>
                <div class="minimap-viewport" id="minimapViewport"></div>
            </div>

            <!-- Navigation Bar -->
            <div class="navigation-bar">
                <button class="nav-btn" onclick="navigate('start')" title="Jump to Start">⏮</button>
                <button class="nav-btn" onclick="navigate('prev')" title="Previous Period">◀</button>
                <button class="nav-btn active" onclick="togglePlay()" title="Play/Pause" id="playBtn">▶</button>
                <button class="nav-btn" onclick="navigate('next')" title="Next Period">▶</button>
                <button class="nav-btn" onclick="navigate('end')" title="Jump to End">⏭</button>
                <button class="nav-btn" onclick="navigate('fit')" title="Fit to Screen">⬚</button>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: var(--occupied)"></div>
                    <span>Occupied</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: var(--active)"></div>
                    <span>Zone Active</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: var(--violation)"></div>
                    <span>Violation</span>
                </div>
            </div>

            <!-- Loading Overlay -->
            <div class="loading-overlay" id="loadingOverlay">
                <div class="spinner"></div>
            </div>
        </div>
    </div>

    <div class="detail-tooltip" id="detailTooltip"></div>

    <script>
        let currentScale = 'day';
        let currentZoom = 3;
        let isPlaying = false;
        let playInterval = null;
        let currentTime = new Date(2025, 8, 15, 8, 0); // Sept 15, 8 AM

        // Initialize ruler based on scale
        function initializeRuler() {
            const ruler = document.getElementById('ruler');
            ruler.innerHTML = '';

            const scales = {
                month: { major: 7, minor: 1, label: 'day' },
                week: { major: 24, minor: 6, label: 'hour' },
                day: { major: 2, minor: 0.5, label: 'hour' },
                hour: { major: 10, minor: 5, label: 'minute' },
                minute: { major: 1, minor: 0.25, label: 'minute' }
            };

            const config = scales[currentScale];
            const totalUnits = currentScale === 'month' ? 30 : 24;

            // Generate major marks
            for (let i = 0; i <= totalUnits; i += config.major) {
                const position = (i / totalUnits) * 100;
                const label = currentScale === 'month' ? `Sept ${i + 1}` : `${i}:00`;
                ruler.innerHTML += `
                    <div class="ruler-major" style="left: ${position}%">
                        <span style="margin-left: 8px">${label}</span>
                    </div>
                `;
            }

            // Generate minor marks
            for (let i = 0; i <= totalUnits; i += config.minor) {
                if (i % config.major !== 0) {
                    const position = (i / totalUnits) * 100;
                    ruler.innerHTML += `<div class="ruler-minor" style="left: ${position}%"></div>`;
                }
            }
        }

        // Initialize sensor tracks
        function initializeSensorTracks() {
            const tracks = document.getElementById('sensorTracks');
            const sensors = [
                { id: 'BV200', name: 'Zone BV200', compliance: 94 },
                { id: 'BV201', name: 'Zone BV201', compliance: 91 },
                { id: 'BV202', name: 'Zone BV202', compliance: 88 },
                { id: 'BV203', name: 'Zone BV203', compliance: 92 },
                { id: 'BV204', name: 'Zone BV204', compliance: 95 }
            ];

            tracks.innerHTML = '';

            sensors.forEach(sensor => {
                const track = document.createElement('div');
                track.className = 'sensor-track';
                track.innerHTML = `
                    <div class="track-header">
                        <div class="track-name">${sensor.name}</div>
                        <div class="track-stats">
                            <span>Compliance: ${sensor.compliance}%</span>
                            <span>Violations: ${Math.floor(Math.random() * 10) + 2}</span>
                        </div>
                    </div>
                    <div class="track-content" id="track-${sensor.id}">
                        <div class="timeline-row occupancy"></div>
                        <div class="timeline-row control"></div>
                    </div>
                `;
                tracks.appendChild(track);

                // Generate timeline segments
                generateTimelineSegments(sensor.id);
            });
        }

        // Generate timeline segments with realistic patterns
        function generateTimelineSegments(sensorId) {
            const occupancyRow = document.querySelector(`#track-${sensorId} .occupancy`);
            const controlRow = document.querySelector(`#track-${sensorId} .control`);
            const trackContent = document.querySelector(`#track-${sensorId}`);

            // Clear existing segments
            occupancyRow.innerHTML = '';
            controlRow.innerHTML = '';

            // Generate occupancy segments
            let currentPos = 0;
            while (currentPos < 100) {
                const segmentWidth = Math.random() * 15 + 5;
                const isOccupied = Math.random() > 0.4;

                const segment = document.createElement('div');
                segment.className = `timeline-segment ${isOccupied ? 'segment-occupied' : 'segment-unoccupied'}`;
                segment.style.left = `${currentPos}%`;
                segment.style.width = `${Math.min(segmentWidth, 100 - currentPos)}%`;
                segment.onclick = () => showSegmentDetail(sensorId, currentPos, isOccupied);
                occupancyRow.appendChild(segment);

                // Corresponding control segment
                const controlSegment = document.createElement('div');
                const isActive = isOccupied ? Math.random() > 0.1 : Math.random() > 0.85;
                controlSegment.className = `timeline-segment ${isActive ? 'segment-active' : 'segment-standby'}`;
                controlSegment.style.left = `${currentPos}%`;
                controlSegment.style.width = `${Math.min(segmentWidth, 100 - currentPos)}%`;
                controlRow.appendChild(controlSegment);

                // Add violation markers
                if (isOccupied !== isActive && Math.random() > 0.7) {
                    const violation = document.createElement('div');
                    violation.className = 'violation-marker';
                    violation.style.left = `${currentPos + segmentWidth / 2}%`;
                    violation.onclick = () => showViolationDetail(sensorId, currentPos);
                    trackContent.appendChild(violation);
                }

                currentPos += segmentWidth;
            }
        }

        // Set timeline scale
        function setScale(scale) {
            showLoading();
            currentScale = scale;

            // Update active button
            document.querySelectorAll('.scale-selector button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update UI
            document.getElementById('zoomLevel').textContent = scale.charAt(0).toUpperCase() + scale.slice(1);
            updateTimeRange();

            // Reinitialize with new scale
            setTimeout(() => {
                initializeRuler();
                initializeSensorTracks();
                updateMinimap();
                hideLoading();
            }, 300);
        }

        // Zoom controls
        function zoomIn() {
            if (currentZoom < 5) {
                currentZoom++;
                updateZoom(currentZoom);
            }
        }

        function zoomOut() {
            if (currentZoom > 1) {
                currentZoom--;
                updateZoom(currentZoom);
            }
        }

        function updateZoom(value) {
            currentZoom = parseInt(value);
            const canvas = document.getElementById('timelineCanvas');
            const newWidth = 100 * (1 + (currentZoom - 1) * 0.5);
            canvas.style.width = `${newWidth}%`;
            updateMinimap();
        }

        // Navigation functions
        function navigate(action) {
            const container = document.getElementById('timelineContainer');
            const scrollAmount = container.clientWidth * 0.8;

            switch (action) {
                case 'start':
                    container.scrollLeft = 0;
                    break;
                case 'end':
                    container.scrollLeft = container.scrollWidth;
                    break;
                case 'prev':
                    container.scrollLeft -= scrollAmount;
                    break;
                case 'next':
                    container.scrollLeft += scrollAmount;
                    break;
                case 'fit':
                    document.getElementById('timelineCanvas').style.width = '100%';
                    currentZoom = 1;
                    break;
            }
        }

        // Play/Pause animation
        function togglePlay() {
            isPlaying = !isPlaying;
            const playBtn = document.getElementById('playBtn');
            playBtn.textContent = isPlaying ? '❚❚' : '▶';

            if (isPlaying) {
                playInterval = setInterval(() => {
                    const container = document.getElementById('timelineContainer');
                    container.scrollLeft += 2;

                    if (container.scrollLeft >= container.scrollWidth - container.clientWidth) {
                        togglePlay();
                    }
                }, 50);
            } else {
                clearInterval(playInterval);
            }
        }

        // Jump to specific points
        function jumpTo(target) {
            const container = document.getElementById('timelineContainer');

            switch (target) {
                case 'today':
                    // Jump to current time (middle of timeline for demo)
                    container.scrollLeft = (container.scrollWidth - container.clientWidth) / 2;
                    break;
                case 'lastViolation':
                    // Jump to last violation (75% for demo)
                    container.scrollLeft = (container.scrollWidth - container.clientWidth) * 0.75;
                    break;
                case 'worstDay':
                    // Jump to worst compliance day (25% for demo)
                    container.scrollLeft = (container.scrollWidth - container.clientWidth) * 0.25;
                    break;
            }
        }

        // Show segment detail
        function showSegmentDetail(sensorId, position, isOccupied) {
            const tooltip = document.getElementById('detailTooltip');
            const time = getTimeFromPosition(position);

            tooltip.innerHTML = `
                <div><strong>${sensorId}</strong></div>
                <div>Time: ${time}</div>
                <div>State: ${isOccupied ? 'Occupied' : 'Unoccupied'}</div>
                <div>Duration: ${Math.floor(Math.random() * 30 + 10)} minutes</div>
            `;

            tooltip.style.left = `${event.pageX + 10}px`;
            tooltip.style.top = `${event.pageY - 40}px`;
            tooltip.classList.add('active');

            setTimeout(() => {
                tooltip.classList.remove('active');
            }, 3000);
        }

        // Show violation detail
        function showViolationDetail(sensorId, position) {
            const tooltip = document.getElementById('detailTooltip');
            const time = getTimeFromPosition(position);

            tooltip.innerHTML = `
                <div style="color: var(--violation)"><strong>Timing Violation</strong></div>
                <div>Sensor: ${sensorId}</div>
                <div>Time: ${time}</div>
                <div>Type: Premature standby transition</div>
                <div>Expected wait: 15 min</div>
                <div>Actual: 3 min</div>
            `;

            tooltip.style.left = `${event.pageX + 10}px`;
            tooltip.style.top = `${event.pageY - 60}px`;
            tooltip.classList.add('active');

            setTimeout(() => {
                tooltip.classList.remove('active');
            }, 3000);
        }

        // Helper function to get time from position
        function getTimeFromPosition(position) {
            const hour = Math.floor((position / 100) * 24);
            const minute = Math.floor(((position / 100) * 24 - hour) * 60);
            return `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
        }

        // Update time range display
        function updateTimeRange() {
            const rangeText = {
                month: 'September 1-30, 2025',
                week: 'Sept 14-20, 2025',
                day: 'Sept 15, 8AM - 8PM',
                hour: 'Sept 15, 10:00 - 11:00 AM',
                minute: 'Sept 15, 10:30:00 - 10:35:00'
            };
            document.getElementById('timeRange').textContent = rangeText[currentScale];
        }

        // Update minimap
        function updateMinimap() {
            const container = document.getElementById('timelineContainer');
            const viewport = document.getElementById('minimapViewport');
            const canvas = document.getElementById('timelineCanvas');

            const scrollRatio = container.scrollLeft / (container.scrollWidth - container.clientWidth);
            const viewportWidth = (container.clientWidth / canvas.offsetWidth) * 100;
            const viewportLeft = scrollRatio * (100 - viewportWidth);

            viewport.style.width = `${viewportWidth}%`;
            viewport.style.left = `${viewportLeft}%`;
            viewport.style.height = '100%';
            viewport.style.top = '0';
        }

        // Track mouse position for cursor
        document.getElementById('timelineContainer').addEventListener('mousemove', (e) => {
            const cursor = document.getElementById('timeCursor');
            const label = document.getElementById('timeLabel');
            const container = e.currentTarget;
            const rect = container.getBoundingClientRect();

            const x = e.clientX - rect.left + container.scrollLeft;
            cursor.style.left = `${x}px`;
            cursor.classList.add('active');

            // Update time label
            const position = (x / container.scrollWidth) * 100;
            const time = getTimeFromPosition(position);
            label.textContent = `Sept 15, ${time}`;
        });

        document.getElementById('timelineContainer').addEventListener('mouseleave', () => {
            document.getElementById('timeCursor').classList.remove('active');
        });

        // Loading overlay
        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        // Scroll event for minimap update
        document.getElementById('timelineContainer').addEventListener('scroll', updateMinimap);

        // Minimap drag functionality
        let isDraggingMinimap = false;
        const minimapViewport = document.getElementById('minimapViewport');

        minimapViewport.addEventListener('mousedown', (e) => {
            isDraggingMinimap = true;
            e.preventDefault();
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDraggingMinimap) return;

            const minimap = document.getElementById('minimap');
            const rect = minimap.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const percentage = (x / rect.width) * 100;

            const container = document.getElementById('timelineContainer');
            const scrollPosition = (percentage / 100) * (container.scrollWidth - container.clientWidth);
            container.scrollLeft = scrollPosition;
        });

        document.addEventListener('mouseup', () => {
            isDraggingMinimap = false;
        });

        // Toggle layers
        function toggleLayer(layer) {
            event.target.classList.toggle('active');
            // Would toggle visibility of specific elements
            console.log('Toggling layer:', layer);
        }

        // Initialize on load
        window.addEventListener('load', () => {
            initializeRuler();
            initializeSensorTracks();
            updateMinimap();
            updateTimeRange();
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            updateMinimap();
        });
    </script>
</body>
</html>